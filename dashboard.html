<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>My Feedback Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body{
  font-family: system-ui, sans-serif;
  background:#fff0f5;
  padding:20px;
}
h2{color:#ff5fa2}
.card{
  background:#fff;
  padding:15px;
  border-radius:14px;
  margin-bottom:15px;
  box-shadow:0 6px 18px rgba(0,0,0,.08);
}
.small{font-size:12px;color:gray}
button{
  border:none;
  padding:6px 10px;
  border-radius:8px;
  cursor:pointer;
  margin-right:6px;
}
.public{background:#ff5fa2;color:white}
.private{background:#ddd}
.pin{background:#ffd166}
.reply{background:#eee}
.replyBox{
  margin-top:8px;
  padding:8px;
  background:#fafafa;
  border-radius:8px;
}
.author{
  font-weight:600;
  color:#ff5fa2;
}
</style>
</head>

<body>

<h2>Your Feedbacks üíå</h2>
<div id="list"></div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getFirestore, collection, query, where, orderBy,
  onSnapshot, updateDoc, doc, addDoc, increment
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCviJWlQvukpfikmHOG-GoAvAnzTBRt8OI",
  authDomain: "cutie-feedback.firebaseapp.com",
  projectId: "cutie-feedback",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// USER FROM URL
const params = new URLSearchParams(window.location.search);
const user = params.get("user");
if(!user){
  document.body.innerHTML="Invalid dashboard link ‚ùå";
  throw "";
}

const list = document.getElementById("list");

const q = query(
  collection(db,"feedbacks"),
  where("toUserId","==",user),
  orderBy("createdAt","desc")
);

onSnapshot(q,snap=>{
  list.innerHTML="";
  snap.forEach(d=>{
    const f=d.data();
    list.innerHTML+=`
      <div class="card">
        <div>${f.text}</div>
        <div class="small">${new Date(f.createdAt).toLocaleString()}</div>

        <div style="margin-top:8px">
          <button class="${f.isPublic?'public':'private'}"
            onclick="toggle('${d.id}',${f.isPublic})">
            ${f.isPublic?'Public':'Private'}
          </button>

          <button class="pin"
            onclick="pin('${d.id}',${f.pinned||false})">
            ${f.pinned?'Unpin':'Pin'}
          </button>

          ‚ù§Ô∏è ${f.likes||0}
        </div>

        ${f.reply?`
          <div class="replyBox">
            <span class="author">You:</span> ${f.reply}
          </div>`:`
          <button class="reply"
            onclick="reply('${d.id}')">Reply</button>
        `}
      </div>
    `;
  });
});

window.toggle = async(id,state)=>{
  await updateDoc(doc(db,"feedbacks",id),{
    isPublic: !state
  });
};

window.pin = async(id,state)=>{
  await updateDoc(doc(db,"feedbacks",id),{
    pinned: !state
  });
};

window.reply = async(id)=>{
  const text = prompt("Your reply:");
  if(!text) return;
  await updateDoc(doc(db,"feedbacks",id),{
    reply:text
  });
};
</script>

</body>
</html>