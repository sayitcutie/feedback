<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Your Feedbacks</title>

  <!-- UI -->
  <link rel="stylesheet" href="dashboard-ui.css">
</head>
<body>

  <!-- TOP BAR -->
  <div class="top">
    <div>Your Feedbacks ðŸ’Œ</div>
    <button id="logoutBtn">Logout</button>
  </div>

  <!-- STATUS -->
  <div class="box" id="statusBox">
    Checking login...
  </div>

  <!-- LINK -->
  <div class="box">
    <h3>Your feedback link</h3>
    <input id="bioLink" readonly />
    <button id="copyBtn">Copy</button>
  </div>

  <!-- MESSAGES -->
  <div class="box">
    <h3>Messages</h3>
    <div id="messagesBox">Loading feedbacks...</div>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // ðŸ”¥ Firebase config (yours is OK)
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "cutie-feedback.firebaseapp.com",
    projectId: "cutie-feedback",
    appId: "YOUR_APP_ID"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // ELEMENTS
  const statusBox = document.getElementById("statusBox");
  const messagesBox = document.getElementById("messagesBox");
  const bioLink = document.getElementById("bioLink");
  const logoutBtn = document.getElementById("logoutBtn");
  const copyBtn = document.getElementById("copyBtn");

  // LOGOUT
  logoutBtn.onclick = async () => {
    await signOut(auth);
    window.location.href = "login.html";
  };

  // COPY LINK
  copyBtn.onclick = () => {
    navigator.clipboard.writeText(bioLink.value);
    copyBtn.innerText = "Copied!";
    setTimeout(() => copyBtn.innerText = "Copy", 1500);
  };

  // ðŸ” AUTH CHECK (RUNS ONCE, CLEAN)
  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "login.html";
      return;
    }

    // âœ… STOP LOADER
    statusBox.innerText = `Logged in as ${user.email}`;

    // FEEDBACK LINK
    bioLink.value = `https://sayitcutie.github.io/feedback/index`;

    // LOAD MESSAGES
    const q = query(
      collection(db, "messages"),
      where("to", "==", user.uid)
    );

    const snap = await getDocs(q);
    messagesBox.innerHTML = "";

    if (snap.empty) {
      messagesBox.innerHTML = "<p>No messages yet</p>";
      return;
    }

    snap.forEach(doc => {
      messagesBox.innerHTML += `
        <div class="message">${doc.data().text}</div>
      `;
    });
  });
</script>

</body>
</html>