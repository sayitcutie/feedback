<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Feedback Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body{
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background:#fff0f6;
  padding:20px;
}
h2{
  color:#ff4f9a;
}
.card{
  background:#fff;
  padding:14px;
  border-radius:12px;
  margin-bottom:12px;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
}
.empty{
  opacity:.6;
  margin-top:20px;
}
.debug{
  font-size:12px;
  color:#999;
  margin-bottom:10px;
}
</style>
</head>

<body>

<h2>Your Feedbacks üíå</h2>
<div id="debug" class="debug"></div>
<div id="list"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* üîë FIREBASE CONFIG ‚Äî KEEP SAME AS index.html */
const firebaseConfig = {
  apiKey: "AIzaSyCviJWlQvukpfikmHOG-GoAvAnzTBRt8OI",
  authDomain: "cutie-feedback.firebaseapp.com",
  projectId: "cutie-feedback",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ‚úÖ GET & NORMALIZE USER */
const params = new URLSearchParams(window.location.search);
const user = (params.get("user") || "").trim().toLowerCase();

const debug = document.getElementById("debug");
const list = document.getElementById("list");

debug.innerText = "Dashboard user = " + (user || "NONE");

/* ‚ùå NO USER ‚Üí STOP */
if(!user){
  list.innerHTML = "<p class='empty'>Invalid dashboard link ‚ùå</p>";
} else {

  /* ‚úÖ SAFE QUERY (NO FILTERS THAT HIDE DATA) */
  const q = query(
    collection(db, "feedbacks"),
    where("toUserId", "==", user)
  );

  onSnapshot(q, snap => {
    list.innerHTML = "";

    if(snap.empty){
      list.innerHTML = "<p class='empty'>No feedbacks yet üíî</p>";
      return;
    }

    snap.forEach(doc => {
      const f = doc.data();
      list.innerHTML += `
        <div class="card">
          ${f.text || ""}
        </div>
      `;
    });
  });
}
</script>

</body>
</html>